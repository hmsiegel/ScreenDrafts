// <autogenerated />
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace ScreenDrafts.Modules.Drafts.Infrastructure.Database.Migrations
{
  /// <inheritdoc />
  public partial class ConvertEpisodeNumberToText : Migration
  {
    /// <inheritdoc />
    protected override void Up(MigrationBuilder migrationBuilder)
    {
      migrationBuilder.Sql(
        """
        UPDATE drafts.drafts
        SET episode_number = TRIM(episode_number)
        WHERE episode_number !~ '^\s*\d+\s*$';
        """);

      migrationBuilder.Sql(
        """
        ALTER TABLE drafts.drafts
          ALTER COLUMN episode_number
          TYPE integer
          USING NULLIF(episode_number, '')::integer
        """);

      migrationBuilder.AlterColumn<int>(
          name: "episode_number",
          schema: "drafts",
          table: "drafts",
          type: "integer",
          nullable: true,
          oldClrType: typeof(string),
          oldType: "text",
          oldNullable: true,
          comment: "Episode number (int)");
    }

    /// <inheritdoc />
    protected override void Down(MigrationBuilder migrationBuilder)
    {
      migrationBuilder.AlterColumn<string>(
          name: "episode_number",
          schema: "drafts",
          table: "drafts",
          type: "text",
          nullable: true,
          oldClrType: typeof(int),
          oldType: "integer",
          oldNullable: true);
    }
  }
}
